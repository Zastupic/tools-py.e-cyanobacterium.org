{% extends "base.html" %} 

{% block title %}
    MIMS Data Analysis | Dissolved Gas & Volatiles Monitor
{% endblock %}

{% block description %}
    Process Membrane Inlet Mass Spectrometry (MIMS) data online. Normalize signals, correct for drift, and calculate gas exchange rates (O2, CO2) in real-time.
{% endblock %}

{% block keywords %}
    MIMS analysis, membrane inlet mass spectrometry, dissolved gas analysis, online mass spec tool, gas exchange monitoring, fermentation analysis, 
    Hiden HPR-40 data, MasSoft data, Quadera data, Quadstar data, Pfeifer Vacuum data
{% endblock %}

{% block extra_schema %}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "SoftwareApplication",
    "name": "CyanoTools MIMS Data Tool",
    "operatingSystem": "Web",
    "applicationCategory": "ScientificSoftware",
    "description": "Process Membrane Inlet Mass Spectrometry data for real-time dissolved gas exchange measurements.",
    "offers": { "@type": "Offer", "price": "0", "priceCurrency": "USD" },
    "featureList": "Signal normalization, Drift correction, Linear regression for gas rates"
  }
  </script>
{% endblock %}

{% block content %}
<!-- Banner -->
<div id="banner-content">
    <div class="banner-desktop"><!-- Desktop banner -->
        <img src="{{ url_for('static', filename='images/homepage_upper_banner_1.jpg') }}"
             alt="CyanoTools analytical tools for algae and cyanobacteria"
             style="width: 100%;">
    </div>
    <div class="banner-mobile"><!-- Mobile banner -->
        <img src="{{ url_for('static', filename='images/homepage_upper_banner_2.jpg') }}"
             alt="CyanoTools mobile banner"
             style="width: 100%;">
    </div>
</div>
<br>
<h1>Membrane Inlet Mass Spectrometry (MIMS)</h1>
<p>Welcome to the tool for analysis of Membrane Inlet Mass Spectrometry (MIMS) data.
MIMS is a highly effective and versatile analytical technique designed for the direct, 
real-time measurement of dissolved gases and volatile organic compounds in a wide variety of samples, 
including water, biological matrices, and atmospheric gases. 
<br>
Central to MIMS is a semi-permeable membrane that acts as an interface, enabling selective passage of analytes from the sample into the mass spectrometer, 
while excluding most of the sample matrix. This configuration allows MIMS to provide continuous, online monitoring with minimal or no sample preparation, 
making it particularly valuable for sensitive and rapid analysis in both research and industrial contexts.
</p>
<br>
<section>
  <h4 style="text-align: left;">Key MIMS advantages</h4>
  <br>
  <ul>
    <li>
      <strong>Direct, Real-Time Monitoring:</strong> 
      MIMS enables immediate measurement of dissolved gases, 
      making it ideal for tracking fast-changing biological processes such as 
      photosynthesis and respiration in iquid cultures of algae and cyanobacteria without delays caused by sample preparation.
    </li>
    <li>
      <strong>High Sensitivity for Trace Gases:</strong> 
      The technique detects gases at sub-parts-per-billion levels, 
      allowing precise analysis of low-concentration metabolic gases like O<sub>2</sub>, CO<sub>2</sub>, CH<sub>4</sub> or other gasses
      that are critical for understanding the physiology and productivity of cyanobacteria and algal cultures.
    </li>
    <li>
      <strong>Broad Applicability to Diverse Biological Samples:</strong> 
      MIMS supports analysis across a wide range of sample types common in algal and cyanobacterial research, 
      including aqueous cultures, biofilms, and sediments, facilitating studies on nutrient cycling, gas exchange, and environmental stress responses.
    </li>
    <li>
      <strong>Continuous and Automated Data Acquisition:</strong> 
      The continuous measurement capability is perfect for long-term monitoring of dynamic processes like diel cycles and metabolic shifts in cyanobacteria
       and algal populations, supporting high-throughput data analysis via integrated tools on the e-cyanobacterium.org platform.
    </li>
    <li>
      <strong>Minimal Sample Preparation and Interference:</strong> 
      MIMS’s membrane inlet design reduces matrix effects and excludes interfering substances from complex biological media, 
      enhancing data reliability and simplifying workflows for researchers using the online analysis tools provided.
    </li>
  </ul>
</section>
<br>
<p>This tool is designed to analyze data generated by the following MIMS models:
<div class="container">
    <div class="gallery_6_img">
        <a href="https://www.hidenanalytical.com/products/gas-analysis/hpr-40-dsa/" target="_blank" rel="noopener" class="gallery__item--1">
            <i style="font-size:80%">Hiden HPR-40</i>
            <img src="static/images/HPR40.jpg" 
            alt="HPR-40 Hiden analytical" class="gallery__item--1">
        </a>
        <a href="https://www.pfeiffer-vacuum.com/global/en/products/measurement-technology/mass-spectrometers/" target="_blank" rel="noopener" class="gallery__item--3">
          <i style="font-size:80%">Prisma Plus&trade;</i>
          <img src="static/images/prisma.jpg" 
          alt="Prisma Plus Pfeifer Vacuum" class="gallery__item--3">
        </a>
        <a href="https://mims.psi.cz/products/mass-spectrometer-ms-gas/" target="_blank" rel="noopener" class="gallery__item--2">
          <i style="font-size:80%">MS GAS</i>
          <img src="static/images/MS100.jpg" 
          alt="MS-GAS-100 Photon System Instruments" class="gallery__item--2">
        </a>
    </div>
</div>
</p>
<br>
<u>How to use this tool:</u>
<br>
<ol>
    <li>Select MIMS model</li>
    <li>Upload MIMS file and preview the data</li>
    <li>Select a signal for normalization and drift correction (typically Ar or N signals)</li>
    <li>Normalize the signals and preview the normalized data</li>
    <li>Find linear regresion coefficients for time intervals of interest (for both raw and normalized signals)</li>
    <li>Download summary .xlsx file with all data</li>
</ol>
<br>
<small><b>Calibrations</b></small>
<p><small>
<u>Calibration of MIMS signals</u>
<br>
  Calibration of raw or normalized MIMS signals is typically done by linear regression between the measured signal 
  and the known concentration of the gas according to the equation:
    <p align="center" style="font-size:14px">$$
    y = a \, x + b
    $$
    </p>
  where <i>y</i> is the gas concentration in real units (e.g. µmol L<sup>-1</sup>), <i>x</i> is the measured MIMS signal (either raw or normalized), 
  <i>a</i> is the calibration slope, and <i>b</i> is the intercept.  
  The slope <i>a</i> describes how strongly the signal responds to changes in concentration, while the intercept <i>b</i> accounts for background MIMS offset.
 Both raw and normalized MIMS signals can be used for calibration. 
 The use of normalized signals assumes that the gas used for normalization remains at a stable concentration in the calibration mixture.
<br><br>
<u>Calibration of slopes (signal derivatives)</u>
<br>
The tool also allows to determine derivatives of the MIMS signal, i.e. the change of signal over time. 
To convert these derivatives into real units (e.g. µmol L<sup>-1</sup> min<sup>-1</sup>), only the slope <i>a</i> is required: 
  <p align="center" style="font-size:14px">$$
    y = a \, s
  $$</p>
Here, <i>s</i> is the derivative of the MIMS signal (<i>signal min<sup>-1</sup></i>), <i>a</i> is again the calibration slope, 
and <i>y</i> is the rate of concentration change in real units.  
The intercept <i>b</i> disappears because the derivative of a constant is zero:
  <p align="center" style="font-size:14px">$$
  \frac{d}{dt}(a \, x + b) = a \, \frac{dx}{dt} + \frac{db}{dt} = a \, s
  $$</p>
<br>
Please note that the equilibrium concentration of dissolved <i>O<sub>2</sub></i> and <i>CO<sub>2</sub></i> in water can be estimated in   
  <a href="/calculators#dO2_conc" target="blank" rel="noopener">dO<sub>2</sub></a> and 
  <a href="https://czechglobe-doab.shinyapps.io/SeawaterCarbonateSystem/" target="blank" rel="noopener">dCO<sub>2</sub> calculators</a>.
</small></p>
<br>
<form method="POST" enctype="multipart/form-data" action="{{ url_for('MIMS_data_analysis.analyze_MIMS_data', _anchor='results') }}">
    <div class="container">
        <div class="form-group">    
            <p><b>1. Select MIMS model</b><p>
            <select name="MIMS_model" class="form-control"  aria-label="MIMS_model">
                <option value="HPR40">MASsoft&reg;7 software; HPR-40 (Hiden Analytical)</option>
                <option value="MSGAS">Quadera&reg; software; MS GAS (Photon System Instruments) or QMS Prisma Plus&trade; (Pfeiffer Vacuum)</option>
                <option value="QMS">Quadstar&reg; software; QMS Prisma Plus&trade; (Pfeiffer Vacuum)</option> 
            </select>
        </div>
        <p class="font-weight-bold">2. Select the MIMS file</p>
        <div class="custom-file">
            <input 
                type="file" 
                class="custom-file-input"  
                name="MIMS_file"
                id="MIMS_file"
                accept=".csv, .CSV, .asc, .ASC"
                style="width:100%">
            <label class="custom-file-label" for="MIMS_file">Select files</label>
        </div>
        <div id="mims-error-alert" class="mt-3"></div>
        <button id="show-image-button" type="submit" class="btn btn-primary">Preview the MIMS file</button>
        <a href="{{url_for('static', filename='files/MIMS example files.zip')}}" download="MIMS_example_file">
            <button type="button" class="btn btn-outline-primary">Download example MIMS files</button>
        </a>
    </div>
</form>
<br>
<p id="preview-label" class="font-weight-bold" style="display: none;">3. Preview the measured signals</p>
<!-- Plot container for raw data -->
<div id="raw-container" class="background-box-plot">
  <div id="raw-plot-div" style="height: 400px;"></div>
</div>
<!-- Normalization controls -->
<div id="normalization-controls" style="display:none; margin-top:20px;">
    <p class="font-weight-bold">4. Normalize the signals</p>
  <label for="normalize-by-select">Select a signal by which all signal will be normalized:</label>
  <select id="normalize-by-select" class="form-control" style="max-width:300px;"></select>
  <div style="margin-bottom: 10px;"></div>
  <button id="normalize-button" class="btn btn-primary">Plot normalized data</button>
</div>
<br>
<p id="normalized-preview-label" class="font-weight-bold" style="display: none;">5. Preview the normalized signals</p>
<!-- Plot container for normalized data -->
<div id="normalized-container" class="background-box-plot">
  <div id="normalized-plot-div" style="height: 400px;"></div>
</div>

<!-- Confirm button to apply linear regression -->
<p id="find-coefficients-label" style="display:none;"><b>6. Find regression coefficients - zoom the normalized plot and click the button below</b>
<br>To find multiple regressions, simply unzoom the normalized plot (by double-click on the plot), zoom new time window and click the button again.</p>
<button id="confirm-selection-button" type="button" class="btn btn-primary" style="display:none;">Find linear regressions for current zoom</button>
<button id="clear-regressions-in-table-button" type="button"class="btn btn-outline-danger" style="display:none;">Remove the last regression line</button>

<!-- Show regressions -->
<div id="regression-results-table" style="margin-top:20px;"></div>

<br>
<!-- Show XLSX download file -->
<div id="xlsx-download-section" style="display:none;">
  <p>7. <b>Download summary XLSX file</b> with raw data, normalized data and regression coefficients for all selected intervals.</p>  
  <button id="download-xlsx" class="btn btn-success">Download summary XLSX file</button>
</div>
<br><br><br><br><br>

<script src="{{url_for('static', filename='js_MIMS.js')}}"></script>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script src="https://cdn.plot.ly/plotly-2.30.1.min.js"></script>
<script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/exceljs/dist/exceljs.min.js"></script>


{% endblock %}