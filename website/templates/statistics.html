{% extends "base.html" %}

{% block title %}
    Online Statistical Data Analyzer | CyanoTools
{% endblock %}

{% block description %}
    Free statistical tool for biological datasets. Generate box plots with swarm overlays, run PCA, and perform normality tests and ANOVA on wet-lab data instantly.
{% endblock %}

{% block keywords %}
    Online statistics for biology,  Statistical analysis, box plot generator, PCA analysis online, ANOVA assumptions test, biological data visualization, experimental data analysis, free statistical software, Shapiro-Wilk test, Levene test, Tukey HSD, ANOVA calculator, Kruskal-Wallis test, effect size calculation, statistical power analysis, bioinformatics tools, data analysis software
{% endblock %}

{% block extra_schema %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "SoftwareApplication",
  "name": "CyanoTools Statistics Beta",
  "operatingSystem": "Web",
  "applicationCategory": "BusinessApplication",
  "description": "Statistical tool for wet-lab data: ANOVA, Kruskal-Wallis, and automated visualization of physiological assays.",
  "offers": { "@type": "Offer", "price": "0", "priceCurrency": "USD" },
  "featureList": "Multi-factor grouping, Significance testing, Instant boxplots and bar charts"
}
</script>
{% endblock %}

{% block content %}
<div class="page-wrapper">
    <div class="wrapper-box">
        <!-- Hero Section -->
        <div class="row mb-4 w-100">
            <div class="col-12">
                <div class="p-4 border rounded shadow-sm bg-white">
                    <h2 class="fw-bold mb-3">
                        <i class="bi bi-graph-up-arrow"></i> Statistics Tool
                    </h2>
                    <p class="lead mb-4" style="font-size: 1.1rem;">
                        Streamline analysis of wet-lab cultivation experiments and physiological assays. 
                        Process complex datasets with multi-factor grouping, descriptive statistics, and instant visualizations.
                    </p>
                    <!-- Key Features Grid -->
                    <div class="row g-3 mb-4">
                        <div class="col-md-3 col-sm-6">
                            <div class="p-3 bg-light rounded h-100">
                                <h6 class="fw-bold text-primary mb-2">
                                    <i class="bi bi-layers"></i> Multi-Factor Analysis
                                </h6>
                                <p class="small mb-0 text-muted">Group by up to 3 factors for comprehensive cross-variable insights</p>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <div class="p-3 bg-light rounded h-100">
                                <h6 class="fw-bold text-primary mb-2">
                                    <i class="bi bi-cpu"></i> Smart Data Parsing
                                </h6>
                                <p class="small mb-0 text-muted">Handles scientific notation and auto-strips units (e.g., "h⁻¹")</p>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <div class="p-3 bg-light rounded h-100">
                                <h6 class="fw-bold text-primary mb-2">
                                    <i class="bi bi-bar-chart"></i> Rich Visualizations
                                </h6>
                                <p class="small mb-0 text-muted">Box plots with swarm overlays plus instant N, Mean, Std Dev</p>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <div class="p-3 bg-light rounded h-100">
                                <h6 class="fw-bold text-primary mb-2">
                                    <i class="bi bi-file-earmark-excel"></i> Easy Export
                                </h6>
                                <p class="small mb-0 text-muted">Download complete analysis reports as .xlsx files</p>
                            </div>
                        </div>
                    </div>
                    <!-- Collapsible Data Requirements (Bootstrap 4) -->
                    <div class="accordion" id="requirementsAccordion">
                        <div class="card">
                            <div class="card-header" id="headingRequirements">
                                <h5 class="mb-0">
                                    <button class="btn btn-link collapsed w-100 text-left" type="button" data-toggle="collapse" data-target="#dataRequirements" aria-expanded="false" aria-controls="dataRequirements">
                                        <i class="bi bi-info-circle mr-2"></i> Data Requirements & Best Practices
                                    </button>
                                </h5>
                            </div>
                            <div id="dataRequirements" class="collapse" aria-labelledby="headingRequirements" data-parent="#requirementsAccordion">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <h6 class="font-weight-bold mb-2">Required Format:</h6>
                                            <ol class="small">
                                                <li><strong>Long Tabular Structure:</strong> One observation per row</li>
                                                <li><strong>Numeric Consistency:</strong> Values must be numeric (units auto-handled)</li>
                                                <li><strong>Independent Measurements:</strong> Each data point should be independent</li>
                                                <li><strong>Discrete Factors:</strong> Use clear categorical variables for grouping</li>
                                            </ol>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="alert alert-info mb-0">
                                                <strong><i class="bi bi-lightbulb"></i> Current Status:</strong>
                                                <p class="small mb-0 mt-2">Optimized for data visualization and basic satistics. ANOVA and advanced statistical tests are under development.</p>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Example Data Download Button Inside Accordion -->
                                    <div class="row mt-3">
                                        <div class="col-12">
                                            <hr class="my-3">
                                            <div class="text-center">
                                                <p class="small text-muted mb-2">Need a sample dataset to get started?</p>
                                                <a href="{{url_for('static', filename='files/ExampleStatisticsData.xlsx')}}" 
                                                   class="btn btn-outline-primary btn-sm" 
                                                   download>
                                                    <i class="bi bi-download mr-1"></i> Download Example Dataset
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Main Work Area -->
        <div class="row w-100">
            <!-- Left Panel: Data Input -->
            <div class="col-md-4">
                <div class="p-3 border rounded shadow-sm bg-light">
                    <h5 class="fw-bold border-bottom pb-2 mb-3">
                        <span class="badge bg-primary me-2">1</span> Data Input
                    </h5>
                    <p class="small text-muted mb-3">
                        Copy-paste date from an Excel file, or paste Tab-delimited data
                    </p>
                    <textarea id="excelPasteBox" class="form-control mb-3" rows="6" 
                              placeholder="Paste your Excel data with headers here..."></textarea>
                    <button id="processDataBtn" class="btn btn-primary w-100 fw-bold shadow-sm">
                        <i class="bi bi-upload"></i> Load Data
                    </button>
                    <!-- Selection Card (hidden initially) -->
                    <div id="selectionCard" class="mt-4" style="display:none;">
                        <h5 class="fw-bold border-bottom pb-2 mb-3">
                            <span class="badge bg-primary me-2">2</span> Select Categirical Factors
                        </h5>
                        <p class="small text-muted mb-3">
                            Choose up to 3 factors to categorize your data
                        </p>
                        
                        <div class="mb-3">
                            <select id="factorSelector" class="form-control form-control-sm">
                                <option value="">-- Choose Factor --</option>
                            </select>
                        </div>
                        <div id="activeFactorsContainer" class="d-flex flex-column gap-2 mb-4"></div>
                        <h5 class="fw-bold border-bottom pb-2 mb-3">
                            <span class="badge bg-primary me-2">3</span> Select Variables
                        </h5>
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="selectAllVars">
                            <label class="form-check-label small fw-bold" for="selectAllVars">
                                Select All Variables
                            </label>
                        </div>
                        
                        <div id="checkboxContainer" class="mb-3" 
                             style="max-height: 300px; overflow-y: auto; padding-right: 5px;"></div>
                        <button id="updateAnalysisBtn" class="btn btn-success w-100 fw-bold shadow-sm">
                            <i class="bi bi-play-fill"></i> Confirm Selection & Start Analyses
                        </button>
                    </div>
                </div>
            </div>
            <!-- Right Panel: Results -->
            <div class="col-md-8">
                <!-- Results Area (hidden initially) -->
                <div id="resultsArea" style="display: none;">
                    <ul class="nav nav-tabs mb-3" id="statsTab" role="tablist">
                        <li class="nav-item">
                            <button class="nav-link active fw-bold" id="viz-tab" 
                                    data-toggle="tab" data-target="#viz-content"> <i class="bi bi-bar-chart-line"></i> Visualizations
                            </button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link fw-bold" id="pca-tab" 
                                    data-toggle="tab" data-target="#pca-content"> <i class="bi bi-grid-3x3-gap"></i> Multivariate (PCA)
                            </button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link fw-bold" id="assumptions-tab" 
                                    data-toggle="tab" data-target="#assumptions-content"> <i class="bi bi-calculator"></i> Assumptions
                            </button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link fw-bold text-success" id="anova-tab" 
                                    data-toggle="tab" data-target="#anova-content" style="display: none;"> 
                                <i class="bi bi-list-check"></i> Significance Tests
                            </button>
                        </li>
                    </ul>
                    <div class="tab-content border p-3 rounded bg-white shadow-sm" id="statsTabContent">
                        <div class="tab-pane fade show active" id="viz-content" role="tabpanel">
                            <div class="p-3">
                                <h5 class="fw-bold mb-3">Data Visualizations</h5>
                                <p class="text-muted small">Generate box plots with swarm overlays for selected variables grouped by factors.</p>
                            
                                <button id="runVizBtn" class="btn btn-primary btn-sm mb-4">
                                    <i class="bi bi-play-fill"></i> Run Visualizations
                                </button>
                                
                                <div id="vizResultsHeader" class="d-flex justify-content-left align-items-left mb-3 pb-2 border-bottom">
                                    <h5 class="fw-bold mb-0"></h5>
                                    <button id="downloadExcelBtn" class="btn btn-success btn-sm fw-bold">
                                        <i class="bi bi-download"></i> Download results
                                    </button>
                                </div>
                            
                                <div id="loadingSpinner" class="loader-container" style="display: none;">
                                    <div class="custom-spinner"></div>
                                </div>
                            
                                <div id="statsContent" class="row"></div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="pca-content" role="tabpanel">
                            <div class="p-3">
                                <h5 class="fw-bold mb-3">Principal Component Analysis</h5>
                                <p class="text-muted small">PCA reduces the dimensionality of your data to show relationships between samples and variables.</p>
                                
                                <div class="bg-light p-3 rounded border mb-3">
                                    <h6 class="fw-bold small mb-2 text-uppercase text-muted">Data Preparation</h6>
                                    <div class="form-check form-switch mb-2">
                                        <input class="form-check-input" type="checkbox" id="pcaRemoveMissing" checked>
                                        <label class="form-check-label small" for="pcaRemoveMissing">
                                            Remove rows with missing data (Required for PCA)
                                        </label>
                                    </div>
                                    <div class="form-check form-switch mb-2">
                                        <input class="form-check-input" type="checkbox" id="pcaAverageByFactor">
                                        <label class="form-check-label small" for="pcaAverageByFactor">
                                            Average replicates by factor(s) before analysis
                                        </label>
                                    </div>
                                </div>

                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" id="pcaShowLoadings" checked>
                                    <label class="form-check-label small fw-bold" for="pcaShowLoadings">
                                        Plot Variable Loadings (Arrows)
                                    </label>
                                </div>

                                <button id="runPCABtn" class="btn btn-primary btn-sm mb-4">
                                    <i class="bi bi-play-fill"></i> Run PCA Analysis
                                </button>
                            
                                <div id="pcaResultsHeader" style="display: none;" class="justify-content-between align-items-center mb-3">
                                    <button id="downloadPCAExcelBtn" class="btn btn-outline-success btn-sm">
                                        <i class="bi bi-file-earmark-excel"></i> Export PCA Report
                                    </button>
                                </div>
                            
                                <div id="pcaSpinner" class="text-center py-4" style="display: none;">
                                    <div class="spinner-border text-primary" role="status"></div>
                                    <p class="mt-2 text-muted small">Calculating Variance & Generating Biplot...</p>
                                </div>
                            
                                <div id="pcaResults" class="text-center"></div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="assumptions-content" role="tabpanel">
                            <div class="text-center py-5">
                                <i class="bi bi-tools fs-1 text-muted"></i>
                                <div class="p-3">
                                    <h5 class="fw-bold mb-3">Statistical Assumptions Tests</h5>

                                    <div class="alert alert-info border-0 shadow-sm mb-4">
                                        <h6 class="fw-bold d-flex align-items-center">
                                            <i class="bi bi-info-circle-fill me-2"></i> How to interpret these tests:
                                        </h6>
                                        <div class="row g-3 mt-1">
                                            <div class="col-md-6">
                                                <div class="p-2 bg-white rounded-3 border-start border-4 border-primary">
                                                    <p class="small mb-1"><strong>1. Shapiro-Wilk (Normality)</strong></p>
                                                    <p class="extra-small text-muted mb-0">
                                                        Checks if each group follows a <strong>Normal Distribution</strong>. 
                                                        If <span class="badge bg-light text-dark">p > 0.05</span>, the data is likely normal (Assumption Met).
                                                    </p>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="p-2 bg-white rounded-3 border-start border-4 border-info">
                                                    <p class="small mb-1"><strong>2. Levene's Test (Homogeneity)</strong></p>
                                                    <p class="extra-small text-muted mb-0">
                                                        Checks if <strong>Variances</strong> are equal across groups. 
                                                        If <span class="badge bg-light text-dark">p > 0.05</span>, variances are consistent (Assumption Met).
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                        <p class="extra-small text-muted mt-3 mb-0 italic">
                                            * Note: If either test fails (p < 0.05), consider using non-parametric alternatives like Kruskal-Wallis or applying data transformations.
                                        </p>
                                    </div>
                                
                                    <button id="runTestsBtn" class="btn btn-primary btn-sm mb-4">
                                        <i class="bi bi-play-fill"></i> Run Normality & Variance Tests
                                    </button>
                                
                                    <div id="testSpinner" class="text-center py-4" style="display: none;">
                                        <div class="spinner-border text-primary" role="status"></div>
                                        <p class="mt-2 text-muted small">Performing statistical calculations...</p>
                                    </div>
                                    <div id="testResults"></div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="anova-content" role="tabpanel">
                            <div class="p-3">
                                <h5 class="fw-bold mb-3">Significance Testing</h5>
                                <div class="alert alert-warning border-0 shadow-sm mb-4">
                                    <h6 class="fw-bold"><i class="bi bi-lightbulb-fill"></i> Decision Guide (Automated)</h6>
                                    <p class="small mb-3">The tool automatically chooses the best statistical approach based on the assumption tests:</p>
    
                                    <ul class="small mb-0 pl-3">
                                        <li><strong>Both normality + homogeneity passed</strong> → 
                                        <strong>One-way ANOVA</strong> followed by <strong>Tukey’s HSD</strong> post-hoc test</li>
        
                                        <li><strong>Only homogeneity of variances passed</strong> → 
                                        <strong>Kruskal–Wallis</strong> test with pairwise Mann–Whitney U tests (Bonferroni corrected)</li>
        
                                        <li><strong>Only normality passed</strong> → 
                                        <strong>Welch’s one-way ANOVA</strong> followed by pairwise Welch’s t-tests (Benjamini–Hochberg corrected)</li>
        
                                        <li><strong>Neither assumption passed</strong> → 
                                        <strong>Kruskal–Wallis</strong> (default) + pairwise Mann–Whitney U tests (Benjamini–Hochberg corrected)</li>
                                    </ul>

                                    <p class="extra-small text-muted mt-3 mb-0">
                                    <i class="bi bi-info-circle"></i> 
                                        Post-hoc comparisons are shown only when the overall test is significant (p &lt; 0.05). 
                                        All p-values in post-hoc tests are corrected for multiple comparisons.
                                    </p>
                                </div>
                                
                                <div id="groupingModeContainer" class="mt-2" style="display: none;">
                                    <div class="card border-success bg-light shadow-sm">
                                        <div class="card-body p-3">
                                            <h6 class="fw-bold text-success mb-2"><i class="bi bi-diagram-3"></i> Post-hoc Grouping Mode</h6>
                                            <select id="groupingMode" class="form-select form-select-sm border-success">
                                                </select>
                                            <p class="extra-small text-muted mt-2 mb-0">
                                                Determines how significance is calculated when multiple factors are present.
                                            </p>
                                        </div>
                                    </div>
                                </div>
                                <br>
                                <button id="runAnovaBtn" class="btn btn-success btn-sm mb-4">
                                    <i class="bi bi-lightning-fill"></i> Run Significance Tests
                                </button>
                                <button id="downloadAnovaExcelBtn" class="btn btn-outline-success btn-sm mb-4" style="display: none;">
                                    <i class="bi bi-file-earmark-excel"></i> Export Significance Report to Excel
                                </button>
                                <div id="anovaSpinner" class="text-center py-4" style="display: none;">
                                    <div class="spinner-border text-success" role="status"></div>
                                    <p class="mt-2 text-muted small">Calculating p-values...</p>
                                </div>
                                <div id="anovaResults"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Placeholder (shown initially) -->
                <div id="placeholderText" class="text-center py-5">
                    <i class="bi bi-table fs-1 text-muted"></i>
                    <h5 class="mt-3 text-muted">Ready to Analyze</h5>
                    <p class="text-muted">Paste your dataset in the left panel to begin</p>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="{{url_for('static', filename='js_statistics.js')}}"></script>
{% endblock %}